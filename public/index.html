<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Light Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            /* Thêm hình nền từ file hoặc URL */
            background-image: url('https://scontent.fhan4-5.fna.fbcdn.net/v/t39.30808-6/426515310_1434132167185729_1834081546063758917_n.jpg?stp=cp6_dst-jpg_s960x960_tt6&_nc_cat=102&ccb=1-7&_nc_sid=cc71e4&_nc_eui2=AeG13tNCYH1_5V7flH1CB5LX-QZyaoxY99n5BnJqjFj32fkOq47Yc2VBH2jiSZHzD_hGBBgsOt_M30u87hqCELC2&_nc_ohc=PUlonBVlwJEQ7kNvgFDBZhR&_nc_oc=AdjVjXT792TLhtXvSoDrF8fTYVxbD_-0NQVz58WGScnE6LyZ44dnw8gUYZ5e6APayyg&_nc_zt=23&_nc_ht=scontent.fhan4-5.fna&_nc_gid=Arsz2tdaxe_88olDAud15Xs&oh=00_AYBu3Tb_Dj_a9QDGF1S5ppKr-TOebr6Dfu3sZnNyKBLPXQ&oe=679435F4'); /* Hoặc local image url('images/background.jpg') */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        h1 {
            text-align: center;
            color: #000000;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px auto;
            max-width: 800px;
        }

        .card {
            padding: 15px;
            background: #06f4f4;
            box-shadow: 0 2px 5px rgba(11, 199, 180, 0.825);
            text-align: center;
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .on {
            background-color: #4caf50;
            color: white;
        }

        .off {
            background-color: #f44336;
            color: rgb(255, 255, 255);
        }

        .active {
            opacity: 1;
        }

        .inactive {
            opacity: 0.5;
        }
    </style>
</head>

<body>
    <h1>HỆ THỐNG ĐÈN NHÀ HOA HẬU</h1>
    <div class="grid">
        <div class="card" id="porch">
            <h3>HIÊN</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node1/porch', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node1/porch', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="living_room1">
            <h3>PHÒNG KHÁCH 1</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node1/living_room1', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node1/living_room1', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="living_room2">
            <h3>PHÒNG KHÁCH 2</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node2/living_room2', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node2/living_room2', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="indoor_street">
            <h3>ĐƯỜNG LUỒNG</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node2/indoor_street', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node2/indoor_street', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="room1">
            <h3>PHÒNG HOÀNG</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node2/room1', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node2/room1', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="room2">
            <h3>PHÒNG HƯƠNG</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node3/room2', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node3/room2', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="room3">
            <h3>PHÒNG BA MẸ</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node3/room3', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node3/room3', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="dining_room">
            <h3>PHÒNG ĂN</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node3/dining_room', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node3/dining_room', 'OFF')">TẮT</button>
        </div>

        <div class="card" id="kitchen">
            <h3>BẾP</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node4/kitchen', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node4/kitchen', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="bath">
            <h3>NHÀ TẮM</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node4/bath', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node4/bath', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="toilet">
            <h3>NHÀ VỆ SINH</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node4/toilet', 'ON')">BẬT</button>
            <button class="off" onclick="controlLight('hoanghoahau/smartlight/node4/toilet', 'OFF')">TẮT</button>
        </div>
        <div class="card" id="washing_machine">
            <h3>MÁY GIẶT</h3>
            <button class="on" onclick="controlLight('hoanghoahau/smartlight/node4/washing_machine', 'ON')">BẬT</button>
            <button class="off"
                onclick="controlLight('hoanghoahau/smartlight/node4/washing_machine', 'OFF')">TẮT</button>
        </div>
    </div>

    <script>
        const states = {};

        function updateButtonState(relay, state) {
            const card = document.getElementById(relay.split('/').slice(-1)[0]);
            const onButton = card.querySelector('.on');
            const offButton = card.querySelector('.off');

            if (state === 'ON') {
                onButton.classList.remove('inactive');
                onButton.classList.add('active');
                offButton.classList.remove('active');
                offButton.classList.add('inactive');
            } else if (state === 'OFF') {
                offButton.classList.remove('inactive');
                offButton.classList.add('active');
                onButton.classList.remove('active');
                onButton.classList.add('inactive');
            }
        }

        async function controlLight(relay, state) {
            try {
                const response = await fetch('/control', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ relay, state }),
                });
                const result = await response.text();
                if (result) {
                    states[relay] = state;
                    updateButtonState(relay, state);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to control light');
            }
        }

        // WebSocket to receive status from server
        const socket = new WebSocket('ws://localhost:3000');
        socket.onmessage = (event) => {
            const { relay, state } = JSON.parse(event.data);
            states[relay] = state;
            updateButtonState(relay, state);
        };
    </script>
</body>

</html>